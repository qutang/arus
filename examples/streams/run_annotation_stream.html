<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Stream using mhealth annotation files &#8212; arus 0.6.2 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          arus</a>
        <span class="navbar-text navbar-version pull-left"><b>0.6.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../index.html">Examples</a></li>
                <li><a href="../../references.html">References</a></li>
                <li><a href="../../news.html">Changelog</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">arus <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Stream using mhealth annotation files</a><ul>
<li><a class="reference internal" href="#imports">Imports</a></li>
<li><a class="reference internal" href="#load-test-annotation-files">Load test annotation files</a></li>
<li><a class="reference internal" href="#setup-stream">Setup stream</a></li>
<li><a class="reference internal" href="#start-stream-and-read-in-data">Start stream and read in data</a></li>
<li><a class="reference internal" href="#stop-stream">Stop stream</a></li>
<li><a class="reference internal" href="#plot-the-stats-of-the-received-data">Plot the stats of the received data</a></li>
</ul>
</li>
</ul>

<div id="sourcelink">
  <a href="../../_sources/examples/streams/run_annotation_stream.rst.txt"
     rel="nofollow">Source</a>
</div>
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-streams-run-annotation-stream-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="stream-using-mhealth-annotation-files">
<span id="sphx-glr-examples-streams-run-annotation-stream-py"></span><h1>Stream using mhealth annotation files<a class="headerlink" href="#stream-using-mhealth-annotation-files" title="Permalink to this headline">¶</a></h1>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arus.testing</span> <span class="kn">import</span> <span class="n">load_test_data</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">arus.core.stream</span> <span class="kn">import</span> <span class="n">AnnotationFileSlidingWindowStream</span>
</pre></div>
</div>
</div>
<div class="section" id="load-test-annotation-files">
<h2>Load test annotation files<a class="headerlink" href="#load-test-annotation-files" title="Permalink to this headline">¶</a></h2>
<p><cite>files</cite> includes more than one file path.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">load_test_data</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;mhealth&#39;</span><span class="p">,</span>
                           <span class="n">sensor_type</span><span class="o">=</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span>
                           <span class="n">file_num</span><span class="o">=</span><span class="s1">&#39;multiple&#39;</span><span class="p">,</span>
                           <span class="n">exception_type</span><span class="o">=</span><span class="s1">&#39;no_missing&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-stream">
<h2>Setup stream<a class="headerlink" href="#setup-stream" title="Permalink to this headline">¶</a></h2>
<p>Stream can accept multiple files as the data source and will read them one by one, so users should ensure the files are sorted in order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">window_size</span> <span class="o">=</span> <span class="mf">12.8</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">AnnotationFileSlidingWindowStream</span><span class="p">(</span><span class="n">data_source</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                                           <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
                                           <span class="n">storage_format</span><span class="o">=</span><span class="s1">&#39;mhealth&#39;</span><span class="p">,</span>
                                           <span class="n">name</span><span class="o">=</span><span class="s1">&#39;annotation-stream&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="start-stream-and-read-in-data">
<h2>Start stream and read in data<a class="headerlink" href="#start-stream-and-read-in-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">get_iterator</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">chunk_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="stop-stream">
<h2>Stop stream<a class="headerlink" href="#stop-stream" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-the-stats-of-the-received-data">
<h2>Plot the stats of the received data<a class="headerlink" href="#plot-the-stats-of-the-received-data" title="Permalink to this headline">¶</a></h2>
<p>The plot shows at many places, the duration of the annotation windows are not as long as the window size. This is normal, because annotations may not fill up the entire window and there are moments covered with no annotations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;annotation durations of each window in the given stream with </span><span class="se">\n</span><span class="s1">window size of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">window_size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; seconds&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
                 <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">xmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">),</span>
                 <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_run_annotation_stream_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_run_annotation_stream_001.png" />
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  3.840 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-streams-run-annotation-stream-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/b5df5599e583ef7420624e91fa8424a4/run_annotation_stream.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">run_annotation_stream.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/55dfeb6c04fe43539dfc9d0d10a01c72/run_annotation_stream.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">run_annotation_stream.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/examples/streams/run_annotation_stream.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2019, Qu Tang.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>